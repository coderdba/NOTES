=================================================
CHEF DEVELOPMENT WITH KITCHEN, BERKSHELF, VAGRANT
=================================================

BASED ON -  http://www.davidmataro.com/chef-development-workflow-with-kitchen-berkshelf-vagrant (not comprehensive)
ALSO ON - 
https://docs.chef.io/berkshelf.html
http://cloudacademy.com/blog/berkshelf-manage-chef-cookbooks/
https://sethvargo.com/berkshelf-workflow/

https://github.com/chef/omnitruck/issues/78

SSL issue: (was 'kitchen converge' ssl certificate errors due to proxy settings - as it worked well from home)
https://groups.google.com/forum/#!topic/vagrant-up/MHmAg0DOQic
https://github.com/chef/chef-dk/issues/106
https://curl.haxx.se/docs/sslcerts.html
https://github.com/test-kitchen/kitchen-docker/issues/72 --> proxy settings
http://stackoverflow.com/questions/35519389/vagrant-cannot-find-box --> says do 'vagrant box add ubuntu/trusty64' manually

Proxy settings:
https://www.kickflop.net/blog/2015/10/28/using-test-kitchen-and-kitchen-vagrant-behind-an-http-proxy/  (READ THIS)
https://github.com/test-kitchen/test-kitchen/issues/1020 (has some extended discussion)

https://docs.chef.io/config_yml_kitchen.html
https://github.com/tmatilai/vagrant-proxyconf/issues/64
https://github.com/tmatilai/vagrant-proxyconf/pull/21
https://github.com/test-kitchen/kitchen-vagrant/issues/90

================================
PROJECT WORKSPACE AND REPOSITORY
================================

- WHAT IS A REPOSITORY
A project repository with the cookbooks and other stuff.

The project contains:
  cookbooks
  roles
  environments
  data_bags

  A Berksfile inside the project repository.
  A .kitchen.yml definition inside the project repository.

- CREATE PROJECTS DIRECTORY
$ mkdir projects
$ cd projects

- CREATE A REPOSITORY FOR A STACK 'MYSTACK' 
$ chef generate app mystack
(screen output further below)

This creates the following files:
NOTE: The cookbooks directory in it

mystack/
  |__ .git
  |__ .gitignore
  |__ .kitchen.yml
  |__ README.md
  |__ cookbooks/
  |    |__ mystack/
  |__ test

NOTE: 'mystack' cookbook is created by chef generate itself with the following content:
-rw-r--r-- 1 x Administrators   50 Mar  8 12:06 Berksfile
-rw-r--r-- 1 x Administrators 1169 Mar  8 12:06 chefignore
-rw-r--r-- 1 x Administrators  211 Mar  8 12:06 metadata.rb
drwxr-xr-x 2 x Administrators    0 Mar  8 12:06 recipes
drwxr-xr-x 3 x Administrators    0 Mar  8 12:06 spec

- CREATE BERKSFILE
NOTE: You can add into Berskfile file as many cookbooks as you wish. 
NOTE: Each cookbook to have their own metadata.rb with their dependencies.
-->    See also ADDING EXTERNAL COOKBOOKS section

Create a Berksfile inside mystack directory and add your cookbooks.

Content of 'Berksfile' file:
NOTE: the first line source "https://supermarket.chef.io" is added in Berksfile if you generate a cookbook using berks also.

source "https://supermarket.chef.io"
cookbook "mystack", path: "cookbooks/mystack"

# ADDING EXTERNAL COOKBOOKS HERE IS NOT PREFERRED - UNLESS YOU JUST WANT TO DOWNLOAD SOME
# Fetch oracle install cookbook called "oracle" from  supermarket
cookbook "oracle"

- CREATE .kitchen.yml in mystack folder
NOTE: Proxy settings were not done here - they were done in os environment

---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  cookbook_path: cookbooks
  roles_path: roles
  environments_path: environments
  data_bags_path: data_bags
  client_rb:
    environment: development

platforms:
  - name: ubuntu/trusty64

suites:
  - name: default
    driver:
      vm_hostname: mystack.loc
      network:
      - ["private_network", {ip: "10.0.0.31",virtualbox__intnet: true}]
      customize:
        memory: 512
        cpus: 1
    run_list:
      - recipe[mystack::default]
    attributes:
   
- CREATE DEVELOPMENT.JSON FILE

To set 'development' settings during testing, trying to set that in .kitchen.yml file configuration.

Create a directory 'environments' under mystack directory.
Create a development.json file in it with the following content.
NOTE: The spelling of directory and file should match environments_path: and environment: settings.

{
  "name": "development",
  "description": "Development environment",
  "cookbook_versions": {
  },
  "json_class": "Chef::Environment",
  "chef_type": "environment",
  "default_attributes": {
    "authorization": {
      "sudo": {
        "users": [
          "vagrant"
        ]
      }
    }
  },
  "override_attributes": {
  }
}

- INSTALL COOKBOOKS USING BERKSHELF
To download all cookbooks dependencies run the next command:

$ berks install
This will produce a file Berksfile.lock in G:\projects\mystack with the following content: (self explanatory)
DEPENDENCIES
  mystack
    path: cookbooks/mystack
  oracle

GRAPH
  mystack (0.1.0)
  oracle (1.2.2)

NOTE: By default all the cookbook dependencies are located at '~/.berkshelf/cookbooks' (G:\home\.berkshelf\cookbooks in Bills Kitchen) 
NOTE: And each cookbook is named using the convention {name}-{version}.

At this time, as we dont have any dependent cookbooks ~/.berkshelf/cookbooks will not have any new items.
Also, the cookbook 'mystack' itself is apparently not copied to ~/.berkshelf/cookbooks 

-- VERIFY 
Go to projects/mystack directory (G:\projects\mystack)
Run the following command: (Note: This command looks for Bersfile.lock file in the current directory)
$ berks list
Cookbooks installed by your Berksfile:
  * mystack (0.1.0) from source at cookbooks/mystack
  * oracle (1.2.2)
  
G:\home\.berkshelf\cookbooks>ls -l
total 4
drwxr-xr-x 10 myuserid Administrators 4096 Mar  8 12:39 oracle-1.2.2

- KITCHEN CONVERGE
Finally, run 'kitchen converge' to start a vagrant virtual machine and install and configure all the software components.

$ cd projects/mystack
$ kitchen converge default

- UPLOAD COOKBOOKS TO CHEF SERVER
To upload all cookbooks to Chef server, you must create a knife.rb configuration inside the .chef/ directory, 
add the validation and user keys and run:

$ berks upload

========================================================
                      FULL EXAMPLE
========================================================
$ mkdir projects
$ cd projects
$ chef generate app mystack
$ cd mystack

---------------------------
/projects/mystack/Berksfile
---------------------------
source 'https://supermarket.chef.io'
#metadata
cookbook "mystack", path: "cookbooks/mystack"

------------------------------
/projects/mystack/.kitchen.yml
------------------------------
---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  cookbook_path: cookbooks
  roles_path: roles
  environments_path: environments
  data_bags_path: data_bags
  client_rb:
    environment: development

platforms:
  - name: ubuntu/trusty64

suites:
  - name: default
    driver:
      vm_hostname: mystack.loc
      network:
      - ["private_network", {ip: "10.0.0.31",virtualbox__intnet: true}]
      customize:
        memory: 512
        cpus: 1
    run_list:
      - recipe[mystack::default]
    attributes:

-----------------------------------------------
/projects/mystack/environments/development.json
-----------------------------------------------
{                                                  
  "name": "development",                           
  "description": "Development environment",        
  "cookbook_versions": {                           
  },                                               
  "json_class": "Chef::Environment",               
  "chef_type": "environment",                      
  "default_attributes": {                          
    "authorization": {                             
      "sudo": {                                    
        "users": [                                 
          "vagrant"                                
        ]                                          
      }                                            
    }                                              
  },                                               
  "override_attributes": {                         
  }                                                
}                                                  

-----------------------------------------------
/projects/mystack/cookbooks/mystack/Berksfile
-----------------------------------------------
source 'https://supermarket.chef.io'
metadata

-----------------------------------------------
/projects/mystack/cookbooks/mystack/metadata.rb
-----------------------------------------------
name 'mystack'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures mystack'
long_description 'Installs/Configures mystack'
version '0.1.0'

depends "tomcat"
depends "apache2"

------------------------------------------------------
/projects/mystack/cookbooks/mystack/recipes/default.rb
------------------------------------------------------
#
# Cookbook Name:: mystack
# Recipe:: default
#
# Copyright (c) 2017 The Authors, All Rights Reserved.

execute 'echo date to /tmp/mystack.out' do
  command 'date >> /tmp/mystack.out'
end

# This is a 'definition' called from apache2 cookbook
# For details refer to http://gettingstartedwithchef.com/first-steps-with-chef.html
apache_site "default" do
  enable true
end

------------------------------------------------------
RUN
------------------------------------------------------
$ cd /projects/mystack
$ kitchen converge
...
This will:
Create the VM
Download dependent cookbooks from supermarket or other sources mentioned in Berksfile(s)
Upload cookbooks to VM in /tmp/kitchen
Run the run-list using chef_zero

------------------------------------------------------
VERIFY
------------------------------------------------------
$ cd /projects/mystack
$ kitchen login

- In the VM
$ id
vagrant

$ curl localhost:80
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>403 Forbidden</title>
</head><body>
<h1>Forbidden</h1>
<p>You don't have permission to access /
on this server.</p>
<hr>
<address>Apache Server at localhost Port 80</address>
</body></html>

------------------------------------------------------
KITHCEN WORKAREA IN VM
------------------------------------------------------
NOTE: Some of these cookbooks may be from previous kitchen converge (not related to this specific apache2 work)
vagrant@mystack:/tmp/kitchen/cookbooks$ ls -l
total 16
drwxr-xr-x 8 vagrant vagrant 4096 Mar  8 11:04 apache2
drwxr-xr-x 4 vagrant vagrant 4096 Mar  8 11:04 compat_resource
drwxr-xr-x 3 vagrant vagrant 4096 Mar  8 11:04 mystack
drwxr-xr-x 6 vagrant vagrant 4096 Mar  8 11:04 tomcat

========================================================
                    DETAILED TOPICS
========================================================

==================================
ADDING EXTERNAL COOKBOOKS
==================================
Cookbooks can be added to Berksfile of the main project/repo - or into metadata.rb of individual cookbooks in the repo.
Berksfile can lookup the list of cookbooks to source from the relevant metadata.rb - provided 'metadata' is mentioned in Berksfile.
Dependent cookbooks of individual cookbooks are looked up at project/repo level only if they are in metadata.rb of cookbooks.
- See CAUTION below

I feel it is better that only nested cookbooks alone be in Berksfile of the repo/project 
- and extenral sourced ones be in individual cookbooks in their metadata.rb

CAUTION
--> DO NOT add dependencies in Berksfile of nested cookbooks - they wont be picked up (https://github.com/berkshelf/berkshelf/pull/304)
--> USE METADATA.RB in cookbooks in a repo
--> ALSO, better use METADATA.RB at the project/repo level also

Project Berksfile: /projects/mystack/Berksfile
source 'https://supermarket.chef.io'
# dont place metadata in the project Berskfile - TBD on how-to/why/why-not
#metadata
cookbook "mystack", path: "cookbooks/mystack"
# dont place external cookbooks in project Berksfile
cookbook "oracle"

Cookbook Berksfile: /projects/mystack/cookbooks/mystack/Berksfile
source 'https://supermarket.chef.io'
metadata 

#DONT PLACE EXTERNAL COOKBOOKS HERE, THEY WONT BE PICKED UP BY PROJECT LEVEL berks install
#cookbook "tomcat6"
#cookbook "tomcat7"
#cookbook "tomcat6apr"

Project metadata.rb:
name 'mystack'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures mystack'
long_description 'Installs/Configures mystack'
version '0.1.0'

# PLACE THE EXTERNAL COOKBOOKS HERE
depends "tomcat"
depends "tomcat6"
depends "tomcat8"

==================================
MULTIPLE SUPERMARKETS - whereby 'depends' clause can directly fetch cookbooks
==================================
Mention the mutliple 'sources' in Berksfile.
-> place in Berksfile of both project and individual cookbooks (so that if the cookbook is run standalone elsewhere, it has the source)
-> place 'depends' in metadata.rb of the cookbook

/projects/mystack/Berksfile:
source 'https://supermarket.chef.io'
source 'https://supermarket.company.com'
cookbook "mystack", path: "cookbooks/mystack"

/projects/mystack/cookbooks/mystack/Berksfile:
source 'https://supermarket.chef.io'
source 'https://supermarket.x.com'
metadata

/projects/mystack/cookbooks/mystack/metadat.rb:
name 'mystack'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures mystack'
long_description 'Installs/Configures mystack'
version '0.1.0'

# These are available in https://supermarket.chef.io
depends "tomcat"
depends "apache2"

# These available in https://supermarket.company.com
depends "centrify"

==================================
NON-SUPERMARKET SOURCES - and 'depends' cannot fetch from them
==================================
Fetch a cookbook from a non-supermarket source like 'git'
Add specific version dependency as well in a cookbook.

/projects/mystack/Berksfile: (add it here as berks install at project level does not recognize entries in cookbook Berksfile)
source 'https://supermarket.chef.io'
source 'https://supermarket.company.com'
#metadata
cookbook "mystack", path: "cookbooks/mystack"
cookbook "somecookbook1", git: "git@github.com:coderdba/somecookbook1.git"

/projects/mystack/cookbooks/mystack/Berksfile: (add it here also so that this cookbook can run standalone)
NOTE: Place metadata after cookbook if depends cribs - https://github.com/berkshelf/berkshelf/issues/892)
source 'https://supermarket.chef.io'
source 'https://supermarket.x.com'
cookbook "cbora12crac1rs", git: "git@github.com:coderdba/cbora12crac1rs.git"
metadata

/projects/mystack/cookbooks/mystack/metadata.rb:
name 'mystack'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures mystack'
long_description 'Installs/Configures mystack'
version '0.1.0'

depends "tomcat"
depends "apache2"

depends "centrify"
depends "somecookbook1", "<= 0.2.1"

Install:
$ cd /projects/mystack
$ berks install

==================================
PROXY SETTINGS 
==================================
You may get SSL/CACERT errors if behind proxy - in the vagrant execution during 'kitchen converge' run.
To avoid that, set proxy environnment variables - either in o/s environment or in kitchen.yml.

-----------------
IN OS ENVIRONMENT
-----------------
set http_proxy=http://yourproxy.example.com:80
set https_proxy=https://yourproxy.example.com:80

--------------
IN KITCHEN.YML
--------------

NOTE: http_proxy_user and http_proxy_password (and so https_ also) may be needed for sections under provisioners

https://www.kickflop.net/blog/2015/10/28/using-test-kitchen-and-kitchen-vagrant-behind-an-http-proxy/

Using test-kitchen and kitchen-vagrant behind an HTTP proxy
Hereâ€™s what got us working with test-kitchen and kitchen-vagrant behind an HTTP proxy. Comments inline.

---
driver:
  name: vagrant
  driver_config:
    # Allows fetching boxes if required
    http_proxy: http://yourproxy.example.com:80
    https_proxy: https://yourproxy.example.com:80
  # This vagrantfiles callout is needed because of
  # https://github.com/test-kitchen/test-kitchen/issues/821
  # You should check that issue to see if this is still required.
  vagrantfiles:
    - your-site-specific-vagrantfile-block.rb
  network:
    - ["private_network", {ip: "192.168.1.2"}]

provisioner:
  name: chef_zero
  # Allows fetching Omnibus Chef installer if required
  http_proxy: http://yourproxy.example.com:80
  https_proxy: http://yourproxy.example.com:80

platforms:
  - name: centos-6.7

suites:
  - name: default
    run_list:
      - recipe[things::default]
    attributes:
      chef-client:
        # Allows your Chef run to fetch stuff it requires
        config:
          http_proxy: "http://yourproxy.example.com:80"
          https_proxy: "http://yourproxy.example.com:80"
And finally your-site-specific-vagrantfile-block.rb, your custom Vagrantfile piece that is merged in via the vagrantfiles directive in your YAML file:

unless Vagrant.has_plugin?("vagrant-proxyconf")
  raise "Missing required plugin 'vagrant-proxyconf', run `vagrant plugin install vagrant-proxyconf`"
end

Vagrant.configure(2) do |config|
  # Allows busser gem and deps to be fetched as required
  config.proxy.http     = "#{ENV['http_proxy']}"
  config.proxy.https    = "#{ENV['https_proxy']}"
  config.proxy.no_proxy = "localhost,127.0.0.1"
end

==========================
RUN KITCHEN CONVERGE
==========================
G:\projects\mystack> kitchen converge default

It ran fine (after some initial hiccups - see further below).

NOTE: there is a "INFO: HTTP Request Returned 404 Not Found: Object not found:" 
        --> But it seems it is only a info message, nad not really any object was 'not found'
        --> search for "Object not found" in this doc for other potential such real errors

G:\projects\mystack>kitchen converge default
-----> Starting Kitchen (v1.6.0)
-----> Converging <default-ubuntu-trusty64>...
       Preparing files for transfer
       Preparing dna.json
       Resolving cookbook dependencies with Berkshelf 4.3.0...
       Removing non-cookbook files before transfer
       Preparing data_bags
       Preparing environments
       Preparing roles
       Preparing solo.rb
-----> Chef Omnibus installation detected (install only if missing)
       Transferring files to <default-ubuntu-trusty64>
       [2017-03-02T14:36:02+00:00] INFO: Forking chef instance to converge...
       Starting Chef Client, version 12.19.36
       [2017-03-02T14:36:02+00:00] INFO: *** Chef 12.19.36 ***
       [2017-03-02T14:36:02+00:00] INFO: Platform: x86_64-linux
       [2017-03-02T14:36:02+00:00] INFO: Chef-client pid: 11480
       [2017-03-02T14:36:04+00:00] INFO: Setting the run_list to ["recipe[mystack::default]"] from CLI options
       [2017-03-02T14:36:04+00:00] INFO: Run List is [recipe[mystack::default]]
       [2017-03-02T14:36:04+00:00] INFO: Run List expands to [mystack::default]
       [2017-03-02T14:36:04+00:00] INFO: Starting Chef Run for default-ubuntu-trusty64
       [2017-03-02T14:36:04+00:00] INFO: Running start handlers
       [2017-03-02T14:36:04+00:00] INFO: Start handlers complete.
       [2017-03-02T14:36:04+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found:
       resolving cookbooks for run list: ["mystack::default"]
       [2017-03-02T14:36:04+00:00] INFO: Loading cookbooks [mystack@0.1.0]
       Synchronizing Cookbooks:
         - mystack (0.1.0)
       Installing Cookbook Gems:
       Compiling Cookbooks...
       Converging 0 resources
       [2017-03-02T14:36:04+00:00] INFO: Chef Run complete in 0.101142095 seconds

       Running handlers:
       [2017-03-02T14:36:04+00:00] INFO: Running report handlers
       Running handlers complete
       [2017-03-02T14:36:04+00:00] INFO: Report handlers complete
       Chef Client finished, 0/0 resources updated in 02 seconds
       Finished converging <default-ubuntu-trusty64> (0m5.59s).
-----> Kitchen is finished. (0m18.41s)

-- Errors faced
The run gave an error - see KITCHEN CONVERGE ERROR2, ERROR3 and ERROR3A in MISCELLANEOUS STUFF section 
- AND IT WAS PLACED IN /tmp/kitchen/cache/chef-stacktrace.out in the VM 
    (see KITCHEN CONVERGE ERROR3 and KITCHEN CONVERGE ERROR3A sections)

HOWEVER, IT SEEMED TO HAVE CREATED THE VM ALRIGHT

--> fixes - spelling errors in environments folder - missing 's'.

---------------------
PROVISIONING COMMAND
---------------------
This is the command kitchen converge actually runs to provision:
sudo -E /opt/chef/bin/chef-solo --config /tmp/kitchen/solo.rb --log_level auto --force-formatter --no-color --json-attributes /tmp/kitchen/dna.json

-----------------
ERROR 404
-----------------
Kept getting this error:

  Unexpected API Request Failure:
  -------------------------------
  Object not found: chefzero://localhost:8889/environments/development

In the VM /tmp/kitchen/environments did not have development.json copied across.
Copied the file from laptop to the VM location.

=========================
LOGON TO VM AND CHECK
=========================
This will take you to the VM:
G:\projects\mystack> kitchen login

----------
In the VM:
----------
Hostname: as given in kitchen.yml, except that the suffix is not there in the VM

$ hostname
mystack

SSH ID: Vagrant as expected for vagrant provisioner

$ id
uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant)

Sudo to root:
$ sudo su
#

Check network: 
NOTE: The IP specified in kitchen.yml has been created (10.0.0.31)

# ifconfig
eth0      Link encap:Ethernet  HWaddr 08:00:27:12:3e:d8
          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0
          inet6 addr: fe80::a00:27ff:fe12:3ed8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:45179 errors:0 dropped:0 overruns:0 frame:0
          TX packets:14609 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:39162113 (39.1 MB)  TX bytes:990660 (990.6 KB)

eth1      Link encap:Ethernet  HWaddr 08:00:27:b6:a5:cf
          inet addr:10.0.0.31  Bcast:10.0.0.255  Mask:255.255.255.0
          inet6 addr: fe80::a00:27ff:feb6:a5cf/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:648 (648.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

=======================
COOKBOOKS ETC IN THE VM
=======================
/tmp/kitchen is where kitchen makes it work-area.

root@mystack:/tmp/kitchen# ls -l
total 40
drwxr-xr-x 2 vagrant vagrant 4096 Mar  2 11:09 cache
-rw------- 1 root    root    1675 Mar  2 09:33 client.pem
-rw-r--r-- 1 vagrant vagrant  649 Mar  2 10:42 client.rb
drwxr-xr-x 3 vagrant vagrant 4096 Mar  2 10:42 cookbooks
drwxr-xr-x 2 vagrant vagrant 4096 Mar  2 10:42 data_bags
-rw-r--r-- 1 vagrant vagrant   41 Mar  2 10:42 dna.json
drwxr-xr-x 2 vagrant vagrant 4096 Mar  2 10:42 environments
drwx------ 2 root    root    4096 Mar  2 09:33 nodes
drwxr-xr-x 2 vagrant vagrant 4096 Mar  2 10:42 roles
-rw-r--r-- 1 vagrant vagrant 1706 Mar  2 10:42 validation.pem

---------------------
Contents of client.rb
---------------------
node_name "default-ubuntu-trusty64"
checksum_path "/tmp/kitchen/checksums"
file_cache_path "/tmp/kitchen/cache"
file_backup_path "/tmp/kitchen/backup"
cookbook_path ["/tmp/kitchen/cookbooks", "/tmp/kitchen/site-cookbooks"]
data_bag_path "/tmp/kitchen/data_bags"
environment_path "/tmp/kitchen/environments"
node_path "/tmp/kitchen/nodes"
role_path "/tmp/kitchen/roles"
client_path "/tmp/kitchen/clients"
user_path "/tmp/kitchen/users"
validation_key "/tmp/kitchen/validation.pem"
client_key "/tmp/kitchen/client.pem"
chef_server_url "http://127.0.0.1:8889"
encrypted_data_bag_secret "/tmp/kitchen/encrypted_data_bag_secret"

ERROR? TBD - However, development.json file was not created in /tmp/kitchen/environments 

======================
MISCELLANEOUS STUFF
======================
------------------------------------
OUTPUT OF CHEF GENERATE APP MYSTACK
------------------------------------
G:\projects>chef generate app mystack
Installing Cookbook Gems:
Compiling Cookbooks...
Recipe: code_generator::app
  * directory[G:/projects/mystack] action create
    - create new directory G:/projects/mystack
  * template[G:/projects/mystack/.kitchen.yml] action create
    - create new file G:/projects/mystack/.kitchen.yml
    - update content in file G:/projects/mystack/.kitchen.yml from none to dad5ad
    (diff output suppressed by config)
  * directory[G:/projects/mystack/test/integration/default/serverspec] action create
    - create new directory G:/projects/mystack/test/integration/default/serverspec
  * directory[G:/projects/mystack/test/integration/helpers/serverspec] action create
    - create new directory G:/projects/mystack/test/integration/helpers/serverspec
  * cookbook_file[G:/projects/mystack/test/integration/helpers/serverspec/spec_helper.rb] action create_if_missing
    - create new file G:/projects/mystack/test/integration/helpers/serverspec/spec_helper.rb
    - update content in file G:/projects/mystack/test/integration/helpers/serverspec/spec_helper.rb from none to d85df4
    (diff output suppressed by config)
  * template[G:/projects/mystack/test/integration/default/serverspec/default_spec.rb] action create_if_missing
    - create new file G:/projects/mystack/test/integration/default/serverspec/default_spec.rb
    - update content in file G:/projects/mystack/test/integration/default/serverspec/default_spec.rb from none to 85cbc2
    (diff output suppressed by config)
  * template[G:/projects/mystack/README.md] action create
    - create new file G:/projects/mystack/README.md
    - update content in file G:/projects/mystack/README.md from none to 7a87fb
    (diff output suppressed by config)
  * directory[G:/projects/mystack/cookbooks] action create
    - create new directory G:/projects/mystack/cookbooks
  * directory[G:/projects/mystack/cookbooks/mystack] action create
    - create new directory G:/projects/mystack/cookbooks/mystack
  * template[G:/projects/mystack/cookbooks/mystack/metadata.rb] action create
    - create new file G:/projects/mystack/cookbooks/mystack/metadata.rb
    - update content in file G:/projects/mystack/cookbooks/mystack/metadata.rb from none to c33348
    (diff output suppressed by config)
  * cookbook_file[G:/projects/mystack/cookbooks/mystack/chefignore] action create
    - create new file G:/projects/mystack/cookbooks/mystack/chefignore
    - update content in file G:/projects/mystack/cookbooks/mystack/chefignore from none to 15fac5
    (diff output suppressed by config)
  * cookbook_file[G:/projects/mystack/cookbooks/mystack/Berksfile] action create
    - create new file G:/projects/mystack/cookbooks/mystack/Berksfile
    - update content in file G:/projects/mystack/cookbooks/mystack/Berksfile from none to 9f08dc
    (diff output suppressed by config)
  * directory[G:/projects/mystack/cookbooks/mystack/recipes] action create
    - create new directory G:/projects/mystack/cookbooks/mystack/recipes
  * template[G:/projects/mystack/cookbooks/mystack/recipes/default.rb] action create
    - create new file G:/projects/mystack/cookbooks/mystack/recipes/default.rb
    - update content in file G:/projects/mystack/cookbooks/mystack/recipes/default.rb from none to 5296c4
    (diff output suppressed by config)
  * directory[G:/projects/mystack/cookbooks/mystack/spec/unit/recipes] action create
    - create new directory G:/projects/mystack/cookbooks/mystack/spec/unit/recipes
  * cookbook_file[G:/projects/mystack/cookbooks/mystack/spec/spec_helper.rb] action create_if_missing
    - create new file G:/projects/mystack/cookbooks/mystack/spec/spec_helper.rb
    - update content in file G:/projects/mystack/cookbooks/mystack/spec/spec_helper.rb from none to 587075
    (diff output suppressed by config)
  * template[G:/projects/mystack/cookbooks/mystack/spec/unit/recipes/default_spec.rb] action create_if_missing
    - create new file G:/projects/mystack/cookbooks/mystack/spec/unit/recipes/default_spec.rb
    - update content in file G:/projects/mystack/cookbooks/mystack/spec/unit/recipes/default_spec.rb from none to 2ee54c
    (diff output suppressed by config)
  * execute[initialize-git] action run
    - execute git init .
  * cookbook_file[G:/projects/mystack/.gitignore] action create
    - create new file G:/projects/mystack/.gitignore
    - update content in file G:/projects/mystack/.gitignore from none to 33d469
    (diff output suppressed by config)

------------------------------------------
KITCHEN CONVERGE SSL/CERT ERROR
------------------------------------------
G:\projects\mystack>kitchen converge default                                                                               
-----> Starting Kitchen (v1.6.0)                                                                                           
-----> Creating <default-ubuntu-trusty64>...                                                                               
       Bringing machine 'default' up with 'virtualbox' provider...                                                         
       ==> default: Box 'ubuntu/trusty64' could not be found. Attempting to find and install...                            
           default: Box Provider: virtualbox                                                                               
           default: Box Version: >= 0                                                                                      
       The box 'ubuntu/trusty64' could not be found or                                                                     
       could not be accessed in the remote catalog. If this is a private                                                   
       box on HashiCorp's Atlas, please verify you're logged in via                                                        
       `vagrant login`. Also, please double-check the name. The expanded                                                   
       URL and error message are shown below:                                                                              
                                                                                                                           
       URL: ["https://atlas.hashicorp.com/ubuntu/trusty64"]                                                                
       Error: SSL certificate problem: self signed certificate in certificate chain                                        
       More details here: http://curl.haxx.se/docs/sslcerts.html                                                           
                                                                                                                           
       curl performs SSL certificate verification by default, using a "bundle"                                             
        of Certificate Authority (CA) public keys (CA certs). If the default                                               
        bundle file isn't adequate, you can specify an alternate file                                                      
        using the --cacert option.                                                                                         
       If this HTTPS server uses a certificate signed by a CA represented in                                               
        the bundle, the certificate verification probably failed due to a                                                  
        problem with the certificate (it might be expired, or the name might                                               
        not match the domain name in the URL).                                                                             
       If you'd like to turn off curl's verification of the certificate, use                                               
        the -k (or --insecure) option.                                                                                     
>>>>>> ------Exception-------                                                                                              
>>>>>> Class: Kitchen::ActionFailed                                                                                        
>>>>>> Message: Failed to complete #create action: [Expected process to exit with [0], but received '1'                    
---- Begin output of vagrant up --no-provision --provider virtualbox ----                                                  
STDOUT: Bringing machine 'default' up with 'virtualbox' provider...                                                        
==> default: Box 'ubuntu/trusty64' could not be found. Attempting to find and install...                                   
    default: Box Provider: virtualbox                                                                                      
    default: Box Version: >= 0                                                                                             
STDERR: The box 'ubuntu/trusty64' could not be found or                                                                    
could not be accessed in the remote catalog. If this is a private                                                          
box on HashiCorp's Atlas, please verify you're logged in via                                                               
`vagrant login`. Also, please double-check the name. The expanded                                                          
URL and error message are shown below:                                                                                     
                                                                                                                           
URL: ["https://atlas.hashicorp.com/ubuntu/trusty64"]                                                                       
Error: SSL certificate problem: self signed certificate in certificate chain                                               
More details here: http://curl.haxx.se/docs/sslcerts.html                                                                  
                                                                                                                           
curl performs SSL certificate verification by default, using a "bundle"                                                    
 of Certificate Authority (CA) public keys (CA certs). If the default                                                      
 bundle file isn't adequate, you can specify an alternate file                                                             
 using the --cacert option.                                                                                                
If this HTTPS server uses a certificate signed by a CA represented in                                                      
 the bundle, the certificate verification probably failed due to a                                                         
 problem with the certificate (it might be expired, or the name might                                                      
 not match the domain name in the URL).                                                                                    
If you'd like to turn off curl's verification of the certificate, use                                                      
 the -k (or --insecure) option.                                                                                            
---- End output of vagrant up --no-provision --provider virtualbox ----                                                    
Ran vagrant up --no-provision --provider virtualbox returned 1]                                                            
>>>>>> ----------------------                                                                                              
>>>>>> Please see .kitchen/logs/kitchen.log for more details                                                               
>>>>>> Also try running `kitchen diagnose --all` for configuration                                                         
                                                                                                                           
------------------------------------
KITCHEN CONVERGE ERROR2
------------------------------------
g:\projects\mystack>kitchen converge
-----> Starting Kitchen (v1.6.0)
-----> Creating <default-ubuntu-trusty64>...
       Bringing machine 'default' up with 'virtualbox' provider...
       ==> default: Checking if box 'ubuntu/trusty64' is up to date...
       ==> default: Fixed port collision for 22 => 2222. Now on port 2200.
       ==> default: Clearing any previously set network interfaces...
       ==> default: Preparing network interfaces based on configuration...
           default: Adapter 1: nat
           default: Adapter 2: intnet
       ==> default: Forwarding ports...
           default: 22 (guest) => 2200 (host) (adapter 1)
       ==> default: Running 'pre-boot' VM customizations...
       ==> default: Booting VM...
       ==> default: Waiting for machine to boot. This may take a few minutes...
           default: SSH address: 127.0.0.1:2200
           default: SSH username: vagrant
           default: SSH auth method: private key
           default: Warning: Remote connection disconnect. Retrying...
           default:
           default: Vagrant insecure key detected. Vagrant will automatically replace
           default: this with a newly generated keypair for better security.
           default:
           default: Inserting generated public key within guest...
           default: Removing insecure key from the guest if it's present...
           default: Key inserted! Disconnecting and reconnecting using new SSH key...
       ==> default: Machine booted and ready!
       ==> default: Checking for guest additions in VM...
       ==> default: Setting hostname...
       ==> default: Configuring and enabling network interfaces...
       ==> default: Configuring proxy for Apt...
       ==> default: Configuring proxy environment variables...
       ==> default: Machine not provisioned because `--no-provision` is specified.
       [SSH] Established
       Vagrant instance <default-ubuntu-trusty64> created.
       Finished creating <default-ubuntu-trusty64> (1m16.55s).
-----> Converging <default-ubuntu-trusty64>...
       Preparing files for transfer
       Preparing dna.json
       Resolving cookbook dependencies with Berkshelf 4.3.0...
       Removing non-cookbook files before transfer
       Preparing data_bags
       Preparing environments
       Preparing roles
       Preparing validation.pem
       Preparing client.rb
-----> Installing Chef Omnibus (install only if missing)
       Downloading https://www.chef.io/chef/install.sh to file /tmp/install.sh
       Trying wget...
       Download complete.
       ubuntu 14.04 x86_64
       Getting information for chef stable  for ubuntu...
       downloading https://omnitruck-direct.chef.io/stable/chef/metadata?v=&p=ubuntu&pv=14.04&m=x86_64
         to file /tmp/install.sh.2625/metadata.txt
       trying wget...
       sha1     a316f74e4a08fd4d2c535460c3aa16d30e09a08e
       sha256   fbf44670ab5b76e4f1a1f5357885dafcc79e543ccbbe3264afd40c15d604b6dc
       url      https://packages.chef.io/files/stable/chef/12.19.36/ubuntu/14.04/chef_12.19.36-1_amd64.deb
       version  12.19.36
       downloaded metadata file looks valid...
       downloading https://packages.chef.io/files/stable/chef/12.19.36/ubuntu/14.04/chef_12.19.36-1_amd64.deb
         to file /tmp/install.sh.2625/chef_12.19.36-1_amd64.deb
       trying wget...
       Comparing checksum with sha256sum...

       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING

       You are installing an omnibus package without a version pin.  If you are installing
       on production servers via an automated process this is DANGEROUS and you will
       be upgraded without warning on new releases, even to new major releases.
       Letting the version float is only appropriate in desktop, test, development or
       CI/CD environments.

       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING

       Installing chef
       installing with dpkg...
(Reading database ... 63122 files and directories currently installed.)
       Preparing to unpack .../chef_12.19.36-1_amd64.deb ...
        * Stopping chef-client chef-client                               [ OK ]
       Unpacking chef (12.19.36-1) over (11.8.2-2) ...
       dpkg: warning: unable to delete old directory '/var/log/chef': Directory not empty
       dpkg: warning: unable to delete old directory '/etc/chef': Directory not empty
       Setting up chef (12.19.36-1) ...
       Thank you for installing Chef!
       Processing triggers for man-db (2.6.7.1-1ubuntu1) ...
       Transferring files to <default-ubuntu-trusty64>
       Starting Chef Client, version 12.19.36
       Creating a new client identity for default-ubuntu-trusty64 using the validator key.

       ================================================================================
       Error expanding the run_list:
       ================================================================================

       Unexpected API Request Failure:
       -------------------------------
       Object not found: chefzero://localhost:8889/environments/development

       Platform:
       ---------
       x86_64-linux

       Running handlers:
       [2017-03-02T09:33:58+00:00] ERROR: Running exception handlers
       Running handlers complete
       [2017-03-02T09:33:58+00:00] ERROR: Exception handlers complete
       Chef Client failed. 0 resources updated in 02 seconds
       [2017-03-02T09:33:58+00:00] FATAL: Stacktrace dumped to /tmp/kitchen/cache/chef-stacktrace.out
       [2017-03-02T09:33:58+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
       [2017-03-02T09:33:58+00:00] ERROR: 404 "Not Found"
       [2017-03-02T09:33:58+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
>>>>>> Converge failed on instance <default-ubuntu-trusty64>.
>>>>>> Please see .kitchen/logs/default-ubuntu-trusty64.log for more details
>>>>>> ------Exception-------
>>>>>> Class: Kitchen::ActionFailed
>>>>>> Message: SSH exited (1) for command: [sh -c '
http_proxy="http://proxyserver.company.com:3128"; export http_proxy
HTTP_PROXY="http://proxyserver.company.com:3128"; export HTTP_PROXY
https_proxy="http://proxyserver.company.com:3128"; export https_proxy
HTTPS_PROXY="http://proxyserver.company.com:3128"; export HTTPS_PROXY
no_proxy="127.0.0.1,localhost,company.com,corp.company.com,hq.company.com,dist.company.com,Email.company.com,stores.company.com,labs.company.com"; export no_proxy
NO_PROXY="127.0.0.1,localhost,company.com,corp.company.com,hq.company.com,dist.company.com,Email.company.com,stores.company.com,labs.company.com"; export NO_PROXY
sudo -E /opt/chef/bin/chef-client --local-mode --config /tmp/kitchen/client.rb --log_level warn --force-formatter --no-color --json-attributes /tmp/kitchen/dna.json --chef-zero-port 8889
']
>>>>>> ----------------------
zlib(finalizer): the stream was freed prematurely.

g:\projects\mystack>{virtualbox__intnet: true}
'{virtualbox__intnet:' is not recognized as an internal or external command,
operable program or batch file.

==================================
KITCHEN CONVERGE ERROR3
==================================
# cat /tmp/kitchen/cache/chef-stacktrace.out
Generated at 2017-03-02 10:20:20 +0000
Net::HTTPServerException: 404 "Not Found"
/opt/chef/embedded/lib/ruby/2.3.0/net/http/response.rb:120:in `error!'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/http.rb:150:in `request'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/http.rb:115:in `get'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/environment.rb:250:in `load'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/node.rb:434:in `apply_expansion_attributes'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/node.rb:423:in `expand!'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/policy_builder/expand_node_object.rb:173:in `expand_run_list'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/policy_builder/expand_node_object.rb:157:in `build_node'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/client.rb:484:in `build_node'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/client.rb:272:in `run'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:295:in `block in fork_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:283:in `fork'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:283:in `fork_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:248:in `block in run_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/local_mode.rb:44:in `with_server_connectivity'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:236:in `run_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application/client.rb:464:in `sleep_then_run_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application/client.rb:451:in `block in interval_run_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application/client.rb:450:in `loop'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application/client.rb:450:in `interval_run_chef_client'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application/client.rb:434:in `run_application'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/lib/chef/application.rb:59:in `run'
/opt/chef/embedded/lib/ruby/gems/2.3.0/gems/chef-12.19.36/bin/chef-client:26:in `<top (required)>'
/opt/chef/bin/chef-client:57:in `load'
/opt/chef/bin/chef-client:57:in `<main>

========================================
KITCHEN CONVERGE ERROR3A
========================================
I, [2017-03-02T16:12:15.320209 #9108]  INFO -- default-ubuntu-trusty64: -----> Converging <default-ubuntu-trusty64>...
I, [2017-03-02T16:12:15.333212 #9108]  INFO -- default-ubuntu-trusty64: Preparing files for transfer
I, [2017-03-02T16:12:15.335712 #9108]  INFO -- default-ubuntu-trusty64: Preparing dna.json
I, [2017-03-02T16:12:15.341213 #9108]  INFO -- default-ubuntu-trusty64: Resolving cookbook dependencies with Berkshelf 4.3.0...
I, [2017-03-02T16:12:15.509747 #9108]  INFO -- default-ubuntu-trusty64: Removing non-cookbook files before transfer
I, [2017-03-02T16:12:15.526250 #9108]  INFO -- default-ubuntu-trusty64: Preparing data_bags
I, [2017-03-02T16:12:15.529251 #9108]  INFO -- default-ubuntu-trusty64: Preparing environments
I, [2017-03-02T16:12:15.533252 #9108]  INFO -- default-ubuntu-trusty64: Preparing roles
I, [2017-03-02T16:12:15.536252 #9108]  INFO -- default-ubuntu-trusty64: Preparing validation.pem
I, [2017-03-02T16:12:15.541253 #9108]  INFO -- default-ubuntu-trusty64: Preparing client.rb
I, [2017-03-02T16:12:15.959337 #9108]  INFO -- default-ubuntu-trusty64: -----> Chef Omnibus installation detected (install only if missing)
I, [2017-03-02T16:12:15.996344 #9108]  INFO -- default-ubuntu-trusty64: Transferring files to <default-ubuntu-trusty64>
I, [2017-03-02T16:12:18.338813 #9108]  INFO -- default-ubuntu-trusty64: Starting Chef Client, version 12.19.36
I, [2017-03-02T16:12:20.505246 #9108]  INFO -- default-ubuntu-trusty64: 
I, [2017-03-02T16:12:20.508247 #9108]  INFO -- default-ubuntu-trusty64: ================================================================================
I, [2017-03-02T16:12:20.518749 #9108]  INFO -- default-ubuntu-trusty64: Error expanding the run_list:
I, [2017-03-02T16:12:20.525750 #9108]  INFO -- default-ubuntu-trusty64: ================================================================================
I, [2017-03-02T16:12:20.544254 #9108]  INFO -- default-ubuntu-trusty64: 
I, [2017-03-02T16:12:20.545754 #9108]  INFO -- default-ubuntu-trusty64: Unexpected API Request Failure:
I, [2017-03-02T16:12:20.551255 #9108]  INFO -- default-ubuntu-trusty64: -------------------------------
I, [2017-03-02T16:12:20.554756 #9108]  INFO -- default-ubuntu-trusty64: Object not found: chefzero://localhost:8889/environments/development
I, [2017-03-02T16:12:20.563758 #9108]  INFO -- default-ubuntu-trusty64: 
I, [2017-03-02T16:12:20.565258 #9108]  INFO -- default-ubuntu-trusty64: Platform:
I, [2017-03-02T16:12:20.567758 #9108]  INFO -- default-ubuntu-trusty64: ---------
I, [2017-03-02T16:12:20.571759 #9108]  INFO -- default-ubuntu-trusty64: x86_64-linux
I, [2017-03-02T16:12:20.573260 #9108]  INFO -- default-ubuntu-trusty64: 
I, [2017-03-02T16:12:20.573760 #9108]  INFO -- default-ubuntu-trusty64: 
I, [2017-03-02T16:12:20.575260 #9108]  INFO -- default-ubuntu-trusty64: Running handlers:
I, [2017-03-02T16:12:20.577260 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] ERROR: Running exception handlers
I, [2017-03-02T16:12:20.581261 #9108]  INFO -- default-ubuntu-trusty64: Running handlers complete
I, [2017-03-02T16:12:20.584262 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] ERROR: Exception handlers complete
I, [2017-03-02T16:12:20.588763 #9108]  INFO -- default-ubuntu-trusty64: Chef Client failed. 0 resources updated in 02 seconds
I, [2017-03-02T16:12:20.592763 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] FATAL: Stacktrace dumped to /tmp/kitchen/cache/chef-stacktrace.out
I, [2017-03-02T16:12:20.598265 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
I, [2017-03-02T16:12:20.605266 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] ERROR: 404 "Not Found"
I, [2017-03-02T16:12:20.608767 #9108]  INFO -- default-ubuntu-trusty64: [2017-03-02T10:42:20+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
E, [2017-03-02T16:12:20.627270 #9108] ERROR -- default-ubuntu-trusty64: Converge failed on instance <default-ubuntu-trusty64>.
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: ------Exception-------
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: Class: Kitchen::ActionFailed
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: Message: SSH exited (1) for command: [sh -c '

sudo -E /opt/chef/bin/chef-client --local-mode --config /tmp/kitchen/client.rb --log_level warn --force-formatter --no-color --json-attributes /tmp/kitchen/dna.json --chef-zero-port 8889
']
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: ---Nested Exception---
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: Class: Kitchen::Transport::SshFailed
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: Message: SSH exited (1) for command: [sh -c '

sudo -E /opt/chef/bin/chef-client --local-mode --config /tmp/kitchen/client.rb --log_level warn --force-formatter --no-color --json-attributes /tmp/kitchen/dna.json --chef-zero-port 8889
']
E, [2017-03-02T16:12:20.627770 #9108] ERROR -- default-ubuntu-trusty64: ------Backtrace-------
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/provisioner/base.rb:76:in `rescue in call'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/provisioner/base.rb:79:in `call'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:373:in `block in converge_action'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:513:in `call'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:513:in `synchronize_or_call'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:478:in `block in action'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/2.1.0/benchmark.rb:279:in `measure'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:477:in `action'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:369:in `converge_action'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:348:in `block in transition_to'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:347:in `each'
E, [2017-03-02T16:12:20.628271 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:347:in `transition_to'
E, [2017-03-02T16:12:20.628771 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/instance.rb:138:in `converge'
E, [2017-03-02T16:12:20.628771 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/command.rb:176:in `public_send'
E, [2017-03-02T16:12:20.628771 #9108] ERROR -- default-ubuntu-trusty64: G:/Tools/chefdk/embedded/lib/ruby/gems/2.1.0/gems/test-kitchen-1.6.0/lib/kitchen/command.rb:176:in `block (2 levels) in run_action'
E, [2017-03-02T16:12:20.628771 #9108] ERROR -- default-ubuntu-trusty64: ----------------------
